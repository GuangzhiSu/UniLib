{% extends "base.html" %}

{% block title %}Dashboard - UniLibPlus{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üìä Dashboard</h1>
    <p>Library Management System Overview</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">{{ stats.total_books }}</div>
        <div class="stat-label">Total Books</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.total_copies }}</div>
        <div class="stat-label">Total Copies</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.total_patrons }}</div>
        <div class="stat-label">Total Patrons</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.active_patrons_90d }}</div>
        <div class="stat-label">Active Patrons (90 days)</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.current_loans }}</div>
        <div class="stat-label">Current Loans</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.overdue_loans }}</div>
        <div class="stat-label">Overdue Loans</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">${{ "%.2f"|format(stats.total_fines) }}</div>
        <div class="stat-label">Total Fines</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.loans_last_7d }}</div>
        <div class="stat-label">Loans (Last 7 days)</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.returns_last_7d }}</div>
        <div class="stat-label">Returns (Last 7 days)</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.avg_duration_days }}</div>
        <div class="stat-label">Avg Loan Duration (days)</div>
    </div>
</div>

{% if stats.overdue_loans > 0 %}
<div class="card">
    <div class="card-header">
        <h2>‚ö†Ô∏è Overdue Loans Risk Alert</h2>
    </div>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Loan ID</th>
                    <th>Patron ID</th>
                    <th>Patron</th>
                    <th>Book</th>
                    <th>Due Date</th>
                    <th>Days Overdue</th>
                    <th>Past Overdue/Late</th>
                    <th>Unpaid Fines</th>
                    <th>Risk Score</th>
                </tr>
            </thead>
            <tbody>
                {% for loan in stats.overdue_risk %}
                <tr>
                    <td>{{ loan.loan_id }}</td>
                    <td>{{ loan.patron_id }}</td>
                    <td>{{ loan.patron_name }}</td>
                    <td>{{ loan.book_title }}</td>
                    <td>{{ loan.due_date | dateformat }}</td>
                    <td>{{ loan.days_overdue }}</td>
                    <td>{{ loan.overdue_or_late_loans }}</td>
                    <td>${{ "%.2f"|format(loan.unpaid_fines or 0) }}</td>
                    <td><strong>{{ "%.1f"|format(loan.risk_score or 0) }}</strong></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="mt-2">
        <a href="{{ url_for('loans', filter='overdue') }}" class="btn btn-warning">View All Overdue Loans</a>
    </div>
</div>
{% endif %}

<div class="card">
    <div class="card-header">
        <h2>Quick Navigation</h2>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <a href="{{ url_for('books') }}" class="btn btn-primary">Browse Books</a>
        <a href="{{ url_for('patrons') }}" class="btn btn-primary">Manage Patrons</a>
        <a href="{{ url_for('loans') }}" class="btn btn-primary">Loan Management</a>
        <a href="{{ url_for('fines') }}" class="btn btn-warning">Fine Management</a>
        <a href="{{ url_for('statistics') }}" class="btn btn-secondary">Statistics</a>
    </div>
</div>
{% endblock %}

